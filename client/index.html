<!DOCTYPE html>
<html lang="en">
<head>
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding:0;
      }
      
      canvas {
        margin: 10px;
        border: 1px solid black;
      }
      
      p {
        margin-left: 12px;
        font-size: 1.2em;
        width: 50%; 
      }
    </style>
    
    <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/babel" >
        "use strict";
        // Some code taken from websockets-n-boots-ajk by Aidan Kaufman

        let socket;
        let userName;
        let judge;
        let myRoom;
        let treatment;
        
        const setupSocket = () => {
            
            socket = io.connect();
            
            socket.on('connect', () => {
                
              userName = document.querySelector('#username').value;
              
              const signIn = document.querySelector('#signIn');
              signIn.innerHTML = "<p>Please wait for players</p>";
                
              socket.emit('join', { name: userName });
            });
            
            // begin setting up the room, save the room name client side
            socket.on('startRoom', (data) => {
                
              console.log('started room');
              console.log(data.chosen);
              judge = data.chosen;
              myRoom = data.room;
    
              if(userName === data.chosen) {
                  
                console.log('asking for treatment');
                  treatee();
              }
            });
            
            socket.on('treaterStart', (data) => {
            console.log('inside treaterStart. userName: ' + userName + ' judge: ' + judge);
              
            if(userName !== judge){
              console.log('Treating, start!');
              treatment = data.treatmentSelected;
              const content = document.querySelector('#mainMessage')
            
              content.innerHTML = "<b>Treat your judge like a " + treatment + "</b> <br /> <input id='appeasement' type='text' /> <input id='sendAppeasement' type='button' value='send' />";
            }
          });
        };

        const treatee = () => {
            
            const signIn = document.querySelector('#signIn');
              signIn.innerHTML = "";
                
            
          const content = document.querySelector("#mainMessage");
          
          content.innerHTML = `<b>How do you want to be treated? (To Cody: this is as far as I could get. There's more that I haven't fully figured out yet.)</b> <br /> <input id="treatment" type="text" />
    <input id='sendTreatment' type='button' value='send' />`;
            
          const sendTreatment = document.querySelector('#sendTreatment');
          sendTreatment.addEventListener('click', treater);
          
            
        };

        const treater = () => {
        
          treatment = document.querySelector('#treatment').value;
          socket.emit('treatmentChosen', { room: myRoom, treatmentSelected: treatment });
        };


        const init = () => {            
          // setup the socket
          const connect = document.querySelector('#connect');
          connect.addEventListener('click', setupSocket);
            
          
            
        };
        
        window.onload = init;
            
    
    </script>
</head>
<body>
    <div id="signIn">
        <label id="welcome" >Welcome to Treat me!</label> <br />
        <label for="user">Username: </label>
        <input id="username" type="text" />
        <input id='connect' type='button' value='send' />
    </div>
    
    <div id='mainMessage'></div>
</body>
</html>